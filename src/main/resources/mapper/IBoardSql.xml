<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.mapper.IBoardMapper">
    <!-- 공통 컬럼 정의 -->
    <sql id="boardColumns">
        idx, myid, writer, subject, content, readcount, regroup, relevel, restep, writeday
    </sql>
    <!-- 페이징을 위한 게시글 목록 -->
    <select id="getBoardListWithPaging" resultType="data.dto.IBoardDto">
        SELECT
        <include refid="boardColumns" />
        FROM iboard
        ORDER BY idx DESC
        LIMIT #{listSize} OFFSET #{start}
    </select>

    <!-- 페이징을 위한 게시글 총 개수 -->
    <select id="getBoardTotalCnt" resultType="int">
        SELECT COUNT(*) FROM iboard
    </select>

    <!-- 게시글 등록 -->
    <insert id="insertBoard" parameterType="data.dto.IBoardDto">
        INSERT INTO iboard (myid, writer, subject, content, writeday)
        VALUES (#{myid}, #{writer}, #{subject}, #{content}, #{writeday})
    </insert>

    <!-- 첨부파일 등록 -->
    <insert id="insertBoardFile" parameterType="data.dto.IBoardFileDto">
        INSERT INTO iboardfile (idx, filename)
        VALUES (#{idx}, #{filename})
    </insert>

    <!-- 게시글 상세 조회 -->
    <select id="getBoardDetail" resultType="data.dto.IBoardDto">
        SELECT
        <include refid="boardColumns" />
        FROM iboard
        WHERE idx = #{idx}
    </select>

    <!-- 첨부파일 목록 조회 -->
    <select id="getBoardFiles" resultType="data.dto.IBoardFileDto">
        SELECT num, idx, filename
        FROM iboardfile
        WHERE idx = #{idx}
    </select>

    <!-- 댓글 목록 조회 -->
    <select id="getRepleList" resultType="data.dto.IBoardRepleDto">
        SELECT num, idx, myid, message, photo, writeday
        FROM iboardreple
        WHERE idx = #{idx}
    </select>

    <!-- 댓글 등록 -->
    <insert id="insertReple" parameterType="data.dto.IBoardRepleDto">
        INSERT INTO iboardreple (idx, myid, message, writeday)
        VALUES (#{idx}, #{myid}, #{message}, #{writeday})
    </insert>
</mapper>